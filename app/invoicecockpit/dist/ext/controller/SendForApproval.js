sap.ui.define(["sap/m/MessageToast"],function(e){"use strict";return{send:async function(e){debugger;let t=e.oModel.getServiceUrl()+e.sPath.substring(1);let r=e.oModel.getServiceUrl()+"rulesParent?$expand=rulptoapp($expand=apptoappm,apptoappg),rulptorul&$filter=active%20eq%20true";var a,o;await $.ajax({url:t,type:"GET",success:function(e){debugger;a=e}});await $.ajax({url:r,type:"GET",success:function(e){debugger;o=e.value}});let l;for(let e=0;e<o.length;e++){let t=0;for(let r=0;r<o[e].rulptorul.length;r++){switch(o[e].rulptorul[r].criteria){case"Amount":switch(o[e].rulptorul[r].condition){case"In Between":if(a.totalDiscountAmount){if(parseInt(a.totalDiscountAmount)>=parseInt(o[e].rulptorul[r].value1)&&parseInt(a.totalDiscountAmount)<=parseInt(o[e].rulptorul[r].value2)){t++}else{t=-1}}break;case"=":if(a.totalDiscountAmount){if(parseInt(a.totalDiscountAmount)==parseInt(o[e].rulptorul[r].value1)){t++}else{t=-1}}break;case">":if(a.totalDiscountAmount){if(parseInt(a.totalDiscountAmount)>parseInt(o[e].rulptorul[r].value1)){t++}else{t=-1}}break;case"<":if(a.totalDiscountAmount){if(parseInt(a.totalDiscountAmount)<parseInt(o[e].rulptorul[r].value1)){t++}else{t=-1}}break;default:break}break;case"Cost Center":if(a.costCenter){if(a.costCenter==o[e].rulptorul[r].value1)t++;else t=-1}break;case"Department":if(a.departmentName){if(a.departmentName==o[e].rulptorul[r].value1)t++;else t=-1}break;case"Document Type":break;case"G/L Account":if(a.glAccount){if(a.glAccount==o[e].rulptorul[r].value1)t++;else t=-1}break;case"Item Category":break;case"Jurisdiction Code":break;case"PO Type":break;case"Vendor":if(a.VendorCode){if(a.VendorCode==o[e].rulptorul[r].value1)t++;else t=-1}break;case"Currency":if(a.currency){if(a.currency==o[e].rulptorul[r].value1)t++;else t=-1}break;default:break}if(t==-1)break}if(t==o[e].rulptorul.length){l=o[e];break}}if(!l){let e=o.filter(e=>e.rulptorul[0].criteria=="Default");l=e[0]}console.log(l);let u=[];for(const t of l.rulptoapp){debugger;let r=t.level.toString();let o=null;let l="";let n="";let s="";if(t.level=="1")o="Pending for Approval";for(const e of t.apptoappm){l+=", "+e.memberName;n+=", "+e.memberName}for(const r of t.apptoappg){debugger;let t=e.oModel.getServiceUrl()+`groups(groupName='${r.groupName}',IsActiveEntity=true)?$expand=grptomem`;await new Promise((e,r)=>{$.ajax({url:t,type:"GET",success:function(t){debugger;for(const e of t.grptomem){l+=", "+e.emailId}e()},error:function(e){r(e)}})});s+=", "+r.groupName}l=l.substring(2);n=n.substring(2);s=s.substring(2);let i={level:r,invoiceNo:a.invoiceNo,invoiceuuid:a.uuid,status:o,approversmails:l,members:n,groups:s};u.push(i)}console.log(u);let n=e.oModel.getServiceUrl()+"approvalWorkFlow";for(let e=0;e<u.length;e++){let t=JSON.stringify(u[e]);await $.ajax({url:n,type:"POST",contentType:"application/json",data:t,success:function(e){debugger}})}try{}catch(e){}}}});