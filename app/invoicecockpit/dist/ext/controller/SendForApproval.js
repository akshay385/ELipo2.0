sap.ui.define(["sap/m/MessageToast"],function(e){"use strict";return{send:async function(e){debugger;let t=e.oModel.getServiceUrl()+e.sPath.substring(1);let r=e.oModel.getServiceUrl()+"rulesParent?$expand=rulptoapp($expand=apptoappm,apptoappg),rulptorul&$filter=active%20eq%20true";var o,a;await $.ajax({url:t,type:"GET",success:function(e){debugger;o=e}});await $.ajax({url:r,type:"GET",success:function(e){debugger;a=e.value}});let l;for(let e=0;e<a.length;e++){let t=0;for(let r=0;r<a[e].rulptorul.length;r++){switch(a[e].rulptorul[r].criteria){case"Amount":switch(a[e].rulptorul[r].condition){case"In Between":if(o.totalDiscountAmount){if(parseInt(o.totalDiscountAmount)>=parseInt(a[e].rulptorul[r].value1)&&parseInt(o.totalDiscountAmount)<=parseInt(a[e].rulptorul[r].value2)){t++}else{t=-1}}break;case"=":if(o.totalDiscountAmount){if(parseInt(o.totalDiscountAmount)==parseInt(a[e].rulptorul[r].value1)){t++}else{t=-1}}break;case">":if(o.totalDiscountAmount){if(parseInt(o.totalDiscountAmount)>parseInt(a[e].rulptorul[r].value1)){t++}else{t=-1}}break;case"<":if(o.totalDiscountAmount){if(parseInt(o.totalDiscountAmount)<parseInt(a[e].rulptorul[r].value1)){t++}else{t=-1}}break;default:break}break;case"Cost Center":if(o.costCenter){if(o.costCenter==a[e].rulptorul[r].value1)t++;else t=-1}break;case"Department":if(o.departmentName){if(o.departmentName==a[e].rulptorul[r].value1)t++;else t=-1}break;case"Document Type":break;case"G/L Account":if(o.glAccount){if(o.glAccount==a[e].rulptorul[r].value1)t++;else t=-1}break;case"Item Category":break;case"Jurisdiction Code":break;case"PO Type":break;case"Vendor":if(o.VendorCode){if(o.VendorCode==a[e].rulptorul[r].value1)t++;else t=-1}break;case"Currency":if(o.currency){if(o.currency==a[e].rulptorul[r].value1)t++;else t=-1}break;default:break}if(t==-1)break}if(t==a[e].rulptorul.length){l=a[e];break}}if(!l){let e=a.filter(e=>e.rulptorul[0].criteria=="Default");l=e[0]}console.log(l);let u=[];for(const t of l.rulptoapp){debugger;let r=t.level.toString();let a=null;let l="";let n="";let s="";if(t.level=="1")a="Pending for Approval";for(const e of t.apptoappm){l+=", "+e.memberName;n+=", "+e.memberName}for(const r of t.apptoappg){debugger;let t=e.oModel.getServiceUrl()+`groups(groupName='${r.groupName}',IsActiveEntity=true)?$expand=grptomem`;await new Promise((e,r)=>{$.ajax({url:t,type:"GET",success:function(t){debugger;for(const e of t.grptomem){l+=", "+e.emailId}e()},error:function(e){r(e)}})});s+=", "+r.groupName}l=l.substring(2);n=n.substring(2);s=s.substring(2);let i={level:r,invoiceNo:o.invoiceNo,invoiceuuid:o.uuid,status:a,approversmails:l,members:n,groups:s};u.push(i)}console.log(u);let n=e.oModel.getServiceUrl()+"approvalWorkFlow";for(let e=0;e<u.length;e++){let t=JSON.stringify(u[e]);await $.ajax({url:n,type:"POST",contentType:"application/json",data:t,success:function(e){debugger}})}try{}catch(e){}let s=setTimeout(()=>{window.history.back()},1e3)}}});